<section class="spend-page center-col">
  <h2 class="spend-headline">Spend calories on...</h2>

  <div class="meal-options">
    <span class="btn primary">Breakfast</span>
    <span class="btn primary">Lunch</span>
    <span class="btn primary">Dinner</span>
    <span class="btn primary">Snack</span>
  </div>

  <div class="calories hidden">
    <form class="spend-form">
      <div class="row row-centered-items">
        <div class="input-wrapper">
          <input type="number" class="calorie-input">
        </div>
      </div>
      <div>
        <span class="btn secondary cancel">Cancel</span>
        <span class="btn primary log-button">Spend</span>
      </div>
    </form>
  </div>
</section>

<script>
Balance.render();

function renderSpendPage(state = {}) {
  const $mealOptions = $('.meal-options');
  const $calories = $('.calories');
  const $headline = $('.spend-headline');

  const fadeInTime = 1000 / 3;

  if (state.mealType && state.mealType.length) {
    $mealOptions.fadeOut(fadeInTime);
    setTimeout(() => {
      $calories.fadeIn(fadeInTime);
      $headline.text(`How many calories?`);
      $('.calorie-input').focus();
      $('.log-button').text(`Spend for ${state.mealType}`);
    }, fadeInTime);
  } else {

    $calories.fadeOut(fadeInTime);
    setTimeout(() => {
      $mealOptions.fadeIn(fadeInTime);
      $headline.text(`What did you eat?`);
    }, fadeInTime);
  }
}

function handleCalorieFormSubmission(event) {
  event.preventDefault();
  alert('submission');
}

$('.spend-form').submit(handleCalorieFormSubmission);

$(() => {
  $('.spend-page').on('click', '.meal-options .btn', function() {
    renderSpendPage({
      mealType: $(this).text()
    });
  });

  $('.spend-page').on('click', '.cancel', function() {
    renderSpendPage({
      mealType: ''
    });
  });

  function restrictInputLength(maxLength, event, value) {
    // Always allow backspace
    if (event.keyCode === 8) {
      return true;
    }
    if (value.toString().length >= maxLength) {
      event.preventDefault();
    }
  }

  $('.log-button').click(() => $('.spend-form').submit());

  $('.spend-page').on('keydown', '.calorie-input', function(event) {
    restrictInputLength(4, event, $(this).val());
  });
});
</script>