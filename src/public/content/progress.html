<div class="stat-wrapper center-col">
  <span class="stat stat-percentage" id="totalDone">0</span>
  <span class="stat-label">Total Progress</span>
</div>

<section class="data-table">
  <div class="data-table-row">
    <div class="data-table-cell data-table-heading">Achievements</div>
  </div>

  <div id="star-rows"></div>
</section>

<script type="text/template" id="progress-row-template">
<div class="data-table-row">
    <div class="data-table-cell {{unlockedClass}}">
      {{about}}
    </div>
  </div>
</script>

<script>
Events.subscribe('starListChanged', list => {
  const done = list.reduce((total, item) =>
    total + (item.locked ? 0 : 1), 0);
  const doneEl = document.getElementById('totalDone');

  if (doneEl) {
    doneEl.textContent = Math.floor((done / list.length) * 100);
  }
});


function fillVars(template = '', vars = {}) {
  for (const varName in vars) {
    const findVarName = new RegExp('{{' + varName + '}}', 'g');
    template = template.replace(findVarName, vars[varName]);
  }
  return template;
}

function renderStars(template, domRoot, stars = []) {
  let rows = [];
  stars.forEach(star => {
    
    const row = fillVars(template, {
      about: star.about,
      unlockedClass: star.locked ? '' : 'data-table-cell-unlocked'
    });

    //const row = template.replace('{{about}}', star.about);
    // data-table-cell-unlocked
    rows.push(row);
  });
  domRoot.innerHTML = rows.join('');
}

renderStars(
  document.getElementById('progress-row-template').text,
  document.getElementById('star-rows'),
  starTracker.getStars()
);


</script>


